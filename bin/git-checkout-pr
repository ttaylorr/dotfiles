#!/usr/bin/env bash

number="$(echo "$1" | grep -oe "[[:digit:]]*$")"
if [ -z "$number" ]; then
  echo >&2 "usage: $0 <number|url>"
  exit 1
fi

url="$(git config remote.origin.url)"

nwo="$(echo "$url" | grep -oe "[:\/]\(.*\)\.git$" | sed -e 's/^://' | sed -e 's/\.git$//')"
owner="$(echo "$nwo" | sed -e 's/\/.*//')"
name="$(echo "$nwo" | sed -e 's/.*\///')"

res="$(curl -s -X POST -n -d@- https://api.github.com/graphql <<EOF
  {
    "query": "{
      repository (owner:\"$owner\" name:\"$name\") {
        name
        pullRequest(number: $number) {
          headRefName
        }
      }
    }"
  }
EOF)"

headRefName="$(echo "$res" | jq ".data.repository.pullRequest.headRefName" | tr -d "\"")"

git checkout "$headRefName"
