#!/usr/bin/env bash

who="${1:-..}"
shift

search_one () {
  local branch="$1"
  shift

  log="$(git log --oneline --no-decorate --grep="$@" --color master..$branch)"
  if test -n "$log"
  then
    if test "$#" -gt 0
    then
      printf "==> %s\n%s\n" "$branch" "$(echo "$log" | grep --color=always "$@")"
    else
      printf "==> %s\n%s\n" "$branch" "$log"
    fi
  fi
}

git branch | grep "$who/" |
  while read branch
  do
    search_one "$branch" "$@"
  done
