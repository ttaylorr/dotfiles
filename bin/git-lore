#!/usr/bin/env bash

set -e

if [ 1 -ne $# ]; then
  echo >&2 "fatal: expected lore.kernel.org URL, aborting ..."
  exit 1
fi

mbox="$(mktemp /tmp/git-lore.mbox.XXXXXX)"
trap "rm -f $mbox" EXIT

curl "$(echo $1 | sed -e 's/\/T\/.*//' | sed -e 's/\/$//')/t.mbox.gz" | gunzip >$mbox
mutt -f $mbox -F <(cat <<-EOF
  source ~/.muttrc

  set postponed=$mbox
EOF
)
